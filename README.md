# electricMeter

В данном репозитории находится набор файлов для логирования расхода электричества при помощи NorthQ Power Reader
А так же методы для атвоматической отправки показателей в мосенергосбыт.


Необходимое железо
-----
* Raspberry Pi + RaZberry
* Fibaro Home Center 2
* NorthQ Power Reader (настроен так, что отправляет показатели раз в 5 минут, чем меньше этот промежуток - тем меньше погрешность, но даже с 5 минутами погрешность за пол года практически отсутствовала)

Необходимое софт
-----
* MySQL
* PHP5
* Apache2+mod_php (или любой другой вебсервер, с поддержкой php)
* curl

Файлы
-----
* config.php - логины и пароли к базе, HC2 и ЛК мосэнерго.
* db.sql - структура базы данных 
  * electric_meter - сюда записываются все данные пришедшие от мосэнергосбыта
  * electric_month - расход электричества в каждый платежный период
  * electric_tarifs - тарифы. Для рассчета стоимости берется последний. Если ничего не заполнить - не будет работать.
* log_electric.php - json api:
  * log_electric.php?c=getDebt - отправляет данные в мосэнергосбыт, чтоб узнать сколько выставят денег за них
  * log_electric.php?c=sendValues - отправляет данные в мосэнергосбыт и завершает текущий платежный период
  * log_electric.php?c=get - получает все текущие показатели. Используется для виртуального устройства.
  * log_electric.php?value=[значение] - сюда передает данные RaspberryPi
* Electric_Meter.vfib - виртуальное устройство для HC2
* class/autoElectric.php - тут происходит основная магия, все методы постарался хоть как-то описать :)
* class/cookie.txt - файл с куками для curl
* class/db_class.php - класс для работы с БД. По факту можно использовать любой другой
